
<script type="text/javascript">

//var tid = "";
//var task = workflow.getFigure(tid);
var listenerId="";
var formPropertyId="";
jq(function(){
	jq('#task-properties-accordion').accordion({
		onSelect:function(title,index){
				
			}
		});
	jq('#nodeType').combobox({
		editable:false,
		onChange:function(newValue, oldValue){
		}
	});
	populateTaskProperites();
});

function saveTaskProperties(){
	task.taskId=jq('#id').val();
	task.taskName=jq('#name').val();
	task.setContent(jq('#name').val());
	task.performerType="candidateUsers";
	task.expression="#{users}";
	task.isUseExpression=true;
	task.dueDate=jq('#dueDate').val();
	task.priority=jq('#priority').val();
	task.nodeType = jq('#nodeType').combobox('getValue');
	if(task.nodeType == "multi"){//多人会签
		task.isSequential = true;
		task._collection="users";
		task._loopCardinality="";
		task._elementVariable="";
		task._completionCondition="";
	}
	jq.messager.alert('信息','保存成功!','info');
}
function populateTaskProperites(){
	task.performerType = "candidateUsers";
	task.expression = "#{users}";
	jq('#id').val(task.taskId);
	jq('#name').val(task.taskName);
	jq('#dueDate').val(task.dueDate);
	jq('#priority').val(task.priority);
}

function loadTaskFormProperties(){
	var props = task.formProperties;
	var prop_grid_rows=[];
	//alert(listeners.getSize());
	for(var i=0;i<props.getSize();i++){
		var prop = props.get(i);
		var nprop = {
					id:prop.id,
					name:prop.name,
					type:prop.type,
					expression:prop.expression,
					variable:prop.variable,
					defaultValue:prop.defaultValue,
					datePattern:prop.datePattern,
					readable:prop.readable,
					writeable:prop.writeable,
					required:prop.required,
					formValues:prop.getValuesString(),
					action:''
				};
		prop_grid_rows[i]=nprop;
	};
	//alert(listener_grid_rows);
	var prop_grid_data={
			total:props.getSize(),
			rows:prop_grid_rows
	};
	jq('#task-form-properties-list').datagrid('loadData',prop_grid_data);
}

</script>
<div id="task-properties-layout" class="easyui-layout" fit="true">
	<div id="task-properties-toolbar-panel" region="north" border="false" style="height:30px;background:#E1F0F2;">
		<a href="##" id="sb2" class="easyui-linkbutton" plain="true" iconCls="icon-save" onclick="saveTaskProperties()">保存</a>
	</div>
	<div id="task-properties-panel" region="center" border="true">
		<div id="task-properties-accordion" class="easyui-accordion" fit="true" border="false">
			<div id="general" title="基础属性" selected="true" class="properties-menu">
				<table id="general-properties">
				<tr>
					<td align="right">Id:</td>
					<td><input type="text" id="id" name="id" value=""/></td>
				</tr>
				<tr>
					<td align="right">名称:</td>
					<td><input type="text" id="name" name="name"  value=""/></td>
				</tr>
				<tr>
					<td align="right">时限:</td>
					<td><input type="text" id="dueDate" name="dueDate" value=""/></td>
				</tr>
				<tr>
					<td align="right">优先级:</td>
					<td><input type="text" id="priority" name="priority" value=""/></td>
				</tr>
				<tr>
					<td align="right">人员:</td>
					<td>
						<select id="nodeType" name="nodeType">
							<option value="only">指定单人</option>
							<option value="more">指定多人-多人抢断</option>
							<option value="multi">指定多人-并行会签</option>
						</select>
					</td>
				</tr>
				</table>
			</div>
			<div id="formProperties" title="表单配置" style="overflow: hidden;">
				<table id="task-form-properties-list">
					<thead>
					<tr>
					<th field="id" width="100" align="middle" sortable="false">Id</th>
					<th field="name" width="100" align="middle" sortable="false">Name</th>
					<th field="type" width="100" align="middle" sortable="false">Type</th>
					<th field="expression" width="100" align="middle" sortable="false">Expression</th>
					<th field="variable" width="100" align="middle" sortable="false">Variable</th>
					<th field="defaultValue" width="100" align="middle" sortable="false">Default</th>
					<th field="datePattern" width="100" align="middle" sortable="false">Date Pattern</th>
					<th field="readable" width="100" align="middle" sortable="false">Readable</th>
					<th field="writeable" width="100" align="middle" sortable="false">Writeable</th>
					<th field="required" width="100" align="middle" sortable="false">Required</th>
					<th field="formValues" width="100" align="middle" sortable="false">Form Values</th>
					<th field="action" width="100" align="middle" formatter="formActionBt">Action</th>
					</tr>
					</thead>
				</table>
			</div>
			
		</div>
	</div>
</div>